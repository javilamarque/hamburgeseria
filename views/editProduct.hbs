{{> header}}

<div class="container">
    <h1>Editar Producto</h1>
    <form id="editProductForm">
        <!-- Campos del formulario para editar el producto -->
        <div class="form-group">
            <label for="cod_barra">Código de Barras:</label>
            <input type="text" class="form-control" id="cod_barra" name="cod_barra" value="{{product.cod_barra}}"
                required>
        </div>
        <div class="form-group">
            <label for="descripcion">Descripción:</label>
            <input type="text" class="form-control" id="descripcion" name="descripcion" value="{{product.descripcion}}"
                required>
        </div>
        <div class="form-group">
            <label for="stock">Stock:</label>
            <input type="number" class="form-control" id="stock" name="stock" value="{{product.stock}}" required>
        </div>
        <div class="form-group">
            <label for="costo">Costo:</label>
            <input type="number" step="0.01" class="form-control" id="costo" name="costo" value="{{product.costo}}"
                required>
        </div>
        <div class="form-group">
            <label for="precio_venta">Precio de Venta:</label>
            <input type="number" step="0.01" class="form-control" id="precio_venta" name="precio_venta"
                value="{{product.precio_venta}}" required>
        </div>
        <div class="form-group text-center">
            <button type="button" onclick="updateProduct()" class="btn btn-primary mt-5">Guardar Cambios</button>
            <button type="button" onclick="cancelEdit()" class="btn btn-danger mt-5">Cancelar</button>
        </div>
    </form>
</div>

<script>
    async function updateProduct() {
        const originalCodBarra = "{{product.cod_barra}}"; // Original barcode
        const cod_barra = document.getElementById('cod_barra').value;
        const descripcion = document.getElementById('descripcion').value;
        const stock = document.getElementById('stock').value;
        const costo = document.getElementById('costo').value;
        const precio_venta = document.getElementById('precio_venta').value;

        const url = `/products/${originalCodBarra}`; // Asegúrate de que la URL sea correcta
        const method = 'PUT';
        const headers = { 'Content-Type': 'application/json' };
        const body = JSON.stringify({ cod_barra, descripcion, stock, costo, precio_venta });

        try {
            const response = await fetch(url, { method, headers, body });
            if (response.ok) {
                alert('Producto actualizado exitosamente');
                window.location.href = '/products'; // Redirigir a la lista de productos
            } else {
                const errorMessage = await response.text();
                throw new Error(errorMessage);
            }
        } catch (error) {
            console.error('Error al actualizar el producto:', error);
            alert('Este codigo de Barras ya esta en uso!!!!');
        }
    }

        function cancelEdit() {
            window.location.href = '/products'; // Redirigir a la lista de productos
        }
</script>

{{>footer}}